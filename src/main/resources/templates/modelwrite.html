<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DB 테이블 생성 페이지</title>
</head>
<body>
<h1>DB 테이블 생성</h1>
<form id="tableForm">
    <label for="table_name">테이블 이름:</label>
    <input type="text" id="table_name" name="table_name" required><br><br>


    <h2>컬럼 정보 입력</h2>
    <input type="button" value="컬럼 추가" onclick="addColumn()">
    <input type="button" value="컬럼 삭제" onclick="deleteColumn(columnCounter)">
    <div id="column_inputs"></div>


    <button type="submit" value="테이블 생성">등록</button>
</form>






<script>
    document.getElementById('tableForm').addEventListener('submit', function (event) {
        event.preventDefault(); // 폼의 기본 동작 (페이지 새로고침)을 막습니다.

        // 테이블 이름 및 컬럼 정보 수집
        let tableName = document.getElementById('table_name').value;
        let columns = {};

        for (let i = 1; i <= columnCounter; i++) {
            const columnNameElement = document.getElementById(`column_name_${i}`);
            const columnTypeElement = document.getElementById(`column_type_${i}`);

            if (columnNameElement && columnTypeElement) {
                columns[`column_name_${i}`] = columnNameElement.value;
                columns[`column_type_${i}`] = columnTypeElement.value;
            }
        }

        // 데이터를 서버로 전송 (예: AJAX 요청)
        sendDataToServer(tableName, columns);

        const data = JSON.stringify({ tableName : tableName, columns : columns });
        alert(data);
    });

    function sendDataToServer(tableName, columns) {
        // AJAX 요청 생성
        const xhr = new XMLHttpRequest();
        const url = '/create-table'; // 서버 스크립트의 URL

        // POST 요청 설정
        xhr.open('POST', url, true);
        xhr.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');

        // 요청 본문 데이터 설정
        const data = JSON.stringify({ tableName : tableName, columns : JSON.stringify(columns) });

        // 요청 전송
        xhr.send(data);

        // 서버 응답 처리
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                // 서버 응답을 처리하는 코드를 여기에 작성
            }
        };
    }




// 컬럼 추가 버튼 누를 시 컬럼이 추가되는 기능

    let columnCounter = 0;

    function addColumn() {
        const columnInputs = document.getElementById('column_inputs');
        columnCounter++;

        const columnDiv = document.createElement('div');
        columnDiv.id = `column_${columnCounter}`;
        columnDiv.innerHTML = `<label for="column_name_${columnCounter}">컬럼 ${columnCounter} 이름:</label>
                                   <input type="text" id="column_name_${columnCounter}" name="column_name_${columnCounter}" required>

                                   <select id = "column_type_${columnCounter}">
                                        <option value="int">INT</option>
                                        <option value="varchar">VARCHAR</option>
                                   </select>


                                   <br><br>`;
        columnInputs.appendChild(columnDiv);
    }

    // 컬럼 삭제버튼 누를 시 숫자가 제일 높은 컬럼부터 삭제 됨
    function deleteColumn(columnNumber) {
        const columnDiv = document.getElementById(`column_${columnNumber}`);
        if (columnDiv) {
            columnDiv.remove();
        }
        columnCounter--;
    }
</script>





</body>
</html>
